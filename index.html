<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="bootstrap/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/font-awesome.css">
</head>
<body>

<div class="container">

    <div class="alert alert-warning alert-window-too-small">
      <strong>Warning!</strong> Your web browser window is too narrow.
    </div>

    <div id="play">
	    <p class="text-center"><button class="btn btn-primary" id="playJack">Play as Jack</button></p>
	    <p class="text-center"><button class="btn btn-danger" id="playPolice">Play as Police</button></p>
	</div>

	<div id="jackSetBase">
		<p>Set Jack's Base.</p>
	</div>

	<div id="jackSetWretched">
		<p>Place <span id="womenMarked"></span> marked women tokens and then <span id="womenFake"></span> unmaked women tokens.</p>
	</div>

	<div id="jackWaitOrKill">
		<p>Check a police token or murder a wretched token.</p>
	</div>



    <div class="map">
		<div class="well well-sm move-tracker">
			<p>
				<span class="label label-default tracker-roman">V</span>
				<span class="label label-default tracker-roman">IV</span>
				<span class="label label-default tracker-roman">III</span>
				<span class="label label-default tracker-roman">II</span>
				<span class="label label-default tracker-roman">I</span>
				<span class="label label-primary tracker active">1</span>
				<span class="label label-primary tracker">2</span>
				<span class="label label-primary tracker">3</span>
				<span class="label label-primary tracker">4</span>
				<span class="label label-primary tracker">5</span>
				<span class="label label-primary tracker">6</span>
				<span class="label label-primary tracker">7</span>
				<span class="label label-primary tracker">8</span>
				<span class="label label-primary tracker">9</span>
				<span class="label label-primary tracker">10</span>
				<span class="label label-primary tracker">11</span>
				<span class="label label-primary tracker">12</span>
				<span class="label label-primary tracker">13</span>
				<span class="label label-primary tracker">14</span>
				<span class="label label-primary tracker">15</span>
			</p>
		</div>
        <img src="images/vintage-map.jpg" class="vintage-map">
        <object data="svg/streets-generated.svg" type="image/svg+xml" class="map-svg" />
    </div>

</div>

<script type="text/javascript" src="js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="js/underscore-min.js"></script>
<script type="text/javascript" src="js/backbone-min.js"></script>
<script type="text/javascript" src="bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/map.js" type="text/javascript"></script>
<script type="text/javascript" src="js/script.js" type="text/javascript"></script>
<script type="text/javascript" src="js/draw.js" type="text/javascript"></script>

<script type="text/javascript">

function disableClicks(removeClasses){
	$('.map .label').off().removeClass(removeClasses)
}

function jackMurder(){
	_.each(jack.get('wretchedTokens'), function(num, key){
		$('.location-' + num.id).click(function(){
			
			// TODO

			$(this).off().addClass('token-woman-selected').removeClass('selectable')
		}).addClass('token token-woman selectable')
	})
}

function policeCheck(){
	_.each(squad.findWhere({lead: true}).get('policeTokens'), function(num, key){
		$('.location-' + num.id).click(function(){

			// TODO
			
			$(this).off().addClass('token-police-selected').removeClass('selectable')
		}).addClass('token token-police selectable')
	})
}

function jackSetWomen(womenCount, womenMarked){
	$('#womenMarked').text(womenMarked)
	$('#womenFake').text(womenCount - womenMarked)
	_.each(map.key('murder'), function(num, key){
		$('.location-' + num).click(function(){
			let womenTokens = jack.get('womenTokens').length
			jack.setToken(key, womenTokens < womenMarked, 'womenTokens', 'murder')
			$(this).off().addClass('token-woman-selected').removeClass('selectable')
			if (womenTokens >= womenCount - 1) {
				squad.findWhere({lead: true}).setPolice()
				jack.setWretched()
				disableClicks('token token-woman selectable')
				policeCheck()
				jackMurder()
			}
		}).addClass('token token-woman selectable')
	})
}

function jackSetBase(){
	$('.location-number').click(function(){
		jack.setBase($(this).data('mapid'))
		$(this).addClass('token-base')
		disableClicks('token selectable')
		jackSetWomen(jack.get('womenCount'), jack.get('womenMarked'))
	}).addClass('token selectable')
}

function play(isJack){
	window.jack = new Jack({'auto': !isJack})
	window.squad = new Squad({'auto': isJack, 'lead': true})
	drawMap()
	if (!isJack) {
		jack.randomBase()
		jack.setWomen()
	} else {
		jackSetBase()
	}
}
$('#playJack').click(function(){
	play(true)
})
$('#playPolice').click(function(){
	play(false)
})

</script>

</body>
</html>